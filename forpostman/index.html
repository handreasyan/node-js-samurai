<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
	      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>
<body>
<button id="createUser">Create User</button>
<button id="getAllUsers">Get All Users</button>
<button id="getUserById">Get User By ID</button>
<button id="updateUserById">Update User By ID</button>
<button id="deleteUserById">Delete User By ID</button>
<div id="view"></div>

<script>
  // define first user id
  let firstUserId = ''
  fetch('http://localhost:8000/api/users').then(res => res.json()).then(users => firstUserId = users.at(0)._id);
</script>
<script>
  // create user
  document.getElementById('createUser').addEventListener('click', async () => {
    const random = Math.random() * 100
    const response = await fetch('http://localhost:8000/api/user', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name: `User N:${Math.round(random)}`,
        email: `user${random}`,
        address: `User in Address:${random})`
      })
    })
    const user = await response.json()

    console.log({user})
    document.getElementById('view').innerHTML = `
		  <div class="user">
		    <h3>${user.name}</h3>
		    <p>Email: ${user.email}</p>
		    <p>Address: ${user.address}</p>
		  </div>
		`

  })
</script>
<script>
  // update user
  document.getElementById('updateUserById').addEventListener('click', async () => {
    const oldResp = await fetch(`http://localhost:8000/api/user/${firstUserId}`)
    const oldUser = await oldResp.json()

    const response = await fetch(`http://localhost:8000/api/update/user/${firstUserId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        ...oldUser,
        name: `Updated: ${oldUser.name}`,
      })
    })
    const user = await response.json()

    document.getElementById('view').innerHTML = `
		  <div class="user">
		    <h3>${user.name}</h3>
		    <p>Email: ${user.email}</p>
		    <p>Address: ${user.address}</p>
		  </div>
		`
  })
</script>
<script>
  // delete user
  document.getElementById('deleteUserById').addEventListener('click', async () => {
    const allResponse = await fetch('http://localhost:8000/api/users')
    const users = await allResponse.json()

    const response = await fetch(`http://localhost:8000/api/delete/user/${users.at(0)._id}`, {
      method: 'DELETE',
    })
    const data = await response.json()
    document.getElementById('view').innerHTML = `<h3>${data}</h3>`

  })
</script>

<script>
  // get all users
  document.getElementById('getAllUsers').addEventListener('click', async () => {
    const response = await fetch('http://localhost:8000/api/users')
    const users = await response.json()
    firstUserId = users.at(0)._id

    document.getElementById('view').innerHTML = users.map(user => `
		  <div class="user">
		    <h3>${user.name}</h3>
		    <p>ID: ${user._id}</p>
		    <p>Email: ${user.email}</p>
		    <p>Address: ${user.address}</p>
		  </div>
		`).join('')

  })
</script>

<script>
  // get user by id
  document.getElementById('getUserById').addEventListener('click', async () => {
    const response = await fetch(`http://localhost:8000/api/user/${firstUserId}`)
    const user = await response.json()

    document.getElementById('view').innerHTML = `
		  <div class="user">
		    <h3>${user.name}</h3>
		    <p>ID: ${user._id}</p>
		    <p>Email: ${user.email}</p>
		    <p>Address: ${user.address}</p>
		  </div>
		`

  })
</script>
</body>
</html>